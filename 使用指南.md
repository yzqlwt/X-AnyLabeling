**步骤 1.** 创建一个 Python 版本为 3.8 或更高版本的 conda 环境，并激活它。

```bash
conda create --name x-anylabeling python=3.9 -y
conda activate x-anylabeling
```

**步骤 2.** 安装 [ONNX Runtime](https://onnxruntime.ai/)。

```bash
# Install ONNX Runtime CPU
pip install onnxruntime

# Install ONNX Runtime GPU (CUDA 11.x)
pip install onnxruntime-gpu==x.x.x

# Install ONNX Runtime GPU (CUDA 12.x)
pip install onnxruntime-gpu --extra-index-url https://aiinfra.pkgs.visualstudio.com/PublicPackages/_packaging/onnxruntime-cuda-12/pypi/simple/
```

> [!Important]
> 对于 GPU 加速，请按照以下说明，确保您本地的 CUDA 和 cuDNN 版本与 ONNX Runtime 版本兼容，并安装需要依赖库，以确保 GPU 加速推理正常：</br>
> Ⅰ. [CUDA Execution Provider](https://onnxruntime.ai/docs/execution-providers/CUDA-ExecutionProvider.html)</br>
> Ⅱ. [Get started with ONNX Runtime in Python](https://onnxruntime.ai/docs/get-started/with-python.html)</br>
> Ⅲ. ONNX Runtime 版本需!!等于!! 1.16.0.

**步骤 3.** 克隆代码仓库。

```bash
git clone https://github.com/CVHub520/X-AnyLabeling.git
```

**步骤 4:** 安装 `requirements.txt` 文件。

对于不同的配置，X-AnyLabeling 提供了以下依赖文件：

| 依赖文件                   | 操作系统        | 运行环境 | 可编译   |
|----------------------------|-----------------|----------|----------|
| requirements.txt           | Windows/Linux   | CPU      | 否       |
| requirements-dev.txt       | Windows/Linux   | CPU      | 是       |
| requirements-gpu.txt       | Windows/Linux   | GPU      | 否       |
| requirements-gpu-dev.txt   | Windows/Linux   | GPU      | 是       |
| requirements-macos.txt     | MacOS           | CPU      | 否       |
| requirements-macos-dev.txt | MacOS           | CPU      | 是       |

- 对于开发者，您应选择带有 `*-dev.txt` 后缀的选项进行安装。
- 如需启用 GPU 加速，您应选择带有 `*-gpu.txt` 后缀的选项进行安装。

使用以下命令安装必要的包，将 [xxx] 替换为适合您需求的安装包名称：

```bash
pip install -r requirements-[xxx].txt
```

此外，对于 macOS 用户，你需要额外运行以下命令从 conda-forge 源安装特定版本的版本：

```bash
conda install -c conda-forge pyqt=5.15.9
```

#### 1.1.3 启动

完成必要步骤后，使用以下命令生成资源：

```bash
pyrcc5 -o anylabeling/resources/resources.py anylabeling/resources/resources.qrc
```

> [!CAUTION]
> 为避免冲突，请执行以下命令卸载第三方相关包。

```bash
pip uninstall anylabeling -y
```

设置环境变量：

```bash
# Linux 或 macOS
export PYTHONPATH=/path/to/X-AnyLabeling
# Windows
set PYTHONPATH=C:\path\to\X-AnyLabeling
```


为了方便用户在不同平台上运行 `X-AnyLabeling`，该工具提供了打包和编译的说明以及相关注意事项。在执行以下打包命令之前，根据您的环境和要求修改 [app_info.py](../../anylabeling/app_info.py) 文件中的 `__preferred_device__` 参数，以选择适当的 GPU 或 CPU 版本进行构建。

注意事项：

1. 在编译之前，请确保 `anylabeling/app_info.py` 文件中的 `__preferred_device__` 参数已根据所需的 GPU/CPU 版本进行修改。

2. 如果编译 GPU 版本，请先激活相应的 GPU 运行环境，并执行 `pip install | grep onnxruntime-gpu` 以确保其正确安装。

3. 对于编译 Windows-GPU 版本，手动修改 `x-anylabeling-win-gpu.spec` 文件中的 `datas` 列表参数，以将本地 `onnxruntime-gpu` 动态库的相关 `*.dll` 文件添加到列表中。

4. 对于编译 Linux-GPU 版本，手动修改 `x-anylabeling-linux-gpu.spec` 文件中的 `datas` 列表参数，以将本地 `onnxruntime-gpu` 动态库的相关 `*.so` 文件添加到列表中。此外，请确保根据您的 CUDA 版本下载匹配的 `onnxruntime-gpu` 包。有关详细的兼容性信息，请参阅 [官方文档](https://onnxruntime.ai/docs/execution-providers/CUDA-ExecutionProvider.html)。

参考命令：

```bash
# Windows-CPU
bash scripts/build_executable.sh win-cpu

# Windows-GPU
bash scripts/build_executable.sh win-gpu

# Linux-CPU
bash scripts/build_executable.sh linux-cpu

# Linux-GPU
bash scripts/build_executable.sh linux-gpu
```

注意：如果在 Windows 上执行上述命令时遇到权限问题，在确保完成上述准备步骤后，可以根据需要直接执行以下命令：

> pyinstaller --noconfirm anylabeling-win-cpu.spec</br>
> pyinstaller --noconfirm anylabeling-win-gpu.spec
